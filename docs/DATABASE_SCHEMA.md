# Snowflake Database Schema — Atsiitsʼiin

Reference schema for the Snowflake backing store. Tables are designed to support multi-user access, semantic recall, and usage tracking.

## Users

```sql
CREATE OR REPLACE TABLE USERS (
    USER_ID STRING PRIMARY KEY,
    EMAIL STRING UNIQUE NOT NULL,
    DISPLAY_NAME STRING,
    AUTH_PROVIDER STRING,
    PLAN_TIER STRING DEFAULT 'FREE',
    RATE_LIMIT_PER_MIN INT DEFAULT 10,
    CREATED_AT TIMESTAMP_NTZ
);
```

## Notes

```sql
CREATE OR REPLACE TABLE NOTES (
    NOTE_ID STRING PRIMARY KEY,
    USER_ID STRING REFERENCES USERS(USER_ID),
    TITLE STRING,
    DESCRIPTION STRING,
    CATEGORY STRING,
    CREATED_AT TIMESTAMP_NTZ
);
```

## Note Chunks

```sql
CREATE OR REPLACE TABLE NOTE_CHUNKS (
    CHUNK_ID STRING PRIMARY KEY,
    NOTE_ID STRING REFERENCES NOTES(NOTE_ID),
    USER_ID STRING REFERENCES USERS(USER_ID),
    CONTENT STRING,
    CONTENT_EMBEDDING VECTOR(FLOAT, 1536),
    CREATED_AT TIMESTAMP_NTZ
);
```

## Queries

```sql
CREATE OR REPLACE TABLE QUERIES (
    QUERY_ID STRING PRIMARY KEY,
    USER_ID STRING REFERENCES USERS(USER_ID),
    PROMPT STRING,
    RESPONSE STRING,
    MODEL_USED STRING,
    CREATED_AT TIMESTAMP_NTZ
);
```

## Tags & Note Tags

Support a tagging taxonomy for classification.

```sql
CREATE OR REPLACE TABLE TAGS (
    TAG_ID STRING PRIMARY KEY,
    NAME STRING UNIQUE NOT NULL
);

CREATE OR REPLACE TABLE NOTE_TAGS (
    NOTE_ID STRING REFERENCES NOTES(NOTE_ID),
    TAG_ID STRING REFERENCES TAGS(TAG_ID),
    PRIMARY KEY (NOTE_ID, TAG_ID)
);
```

## Usage Metrics (Optional)

Capture rate limiting and usage monitoring for paid tiers.

```sql
CREATE OR REPLACE TABLE USAGE_METRICS (
    EVENT_ID STRING PRIMARY KEY,
    USER_ID STRING REFERENCES USERS(USER_ID),
    EVENT_TYPE STRING,
    EVENT_TS TIMESTAMP_NTZ,
    METADATA OBJECT
);
```

